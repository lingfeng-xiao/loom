# Git 规范

## 1. 分支管理

### 1.1 分支类型
- **main**：主分支，用于发布生产版本，保持稳定
- **develop**：开发分支，集成所有功能开发，是主要的开发分支
- **feature/**：功能分支，用于开发新功能，从 develop 分支创建
- **bugfix/**：bug 修复分支，用于修复 develop 分支上的 bug
- **release/**：发布分支，用于准备发布版本，从 develop 分支创建
- **hotfix/**：热修复分支，用于紧急修复生产问题，从 main 分支创建

### 1.2 分支命名规范
- 分支名称使用小写字母、数字和连字符
- 功能分支：`feature/功能名称`，如 `feature/user-profile`
- Bug 修复分支：`bugfix/问题描述`，如 `bugfix/login-error`
- 发布分支：`release/版本号`，如 `release/1.2.0`
- 热修复分支：`hotfix/问题描述`，如 `hotfix/security-vulnerability`

### 1.3 分支生命周期管理
- **feature 分支**：开发完成后，合并到 develop 分支，然后删除
- **bugfix 分支**：修复完成后，合并到 develop 分支，然后删除
- **release 分支**：发布完成后，合并到 main 和 develop 分支，然后删除
- **hotfix 分支**：修复完成后，合并到 main 和 develop 分支，然后删除

### 1.4 分支合并策略
- **feature/bugfix 到 develop**：使用常规合并（merge）
- **release 到 main**：使用常规合并（merge），并创建标签
- **release 到 develop**：使用常规合并（merge）
- **hotfix 到 main**：使用常规合并（merge），并创建标签
- **hotfix 到 develop**：使用常规合并（merge）
- **避免使用 fast-forward 合并**：保持分支历史清晰

### 1.5 分支同步
- 定期从上游分支（如 develop 或 main）拉取最新代码
- 在提交 Pull Request 前，确保分支与目标分支保持同步
- 使用 `git rebase` 保持本地分支历史整洁

## 2. Commit 消息规范

### 2.1 Commit 消息格式
```
<类型>(<范围>): <描述>

[可选的正文]

[可选的脚注]
```

### 2.2 类型
- **feat**：新功能
- **fix**：修复 bug
- **docs**：文档更新
- **style**：代码风格调整（不影响功能）
- **refactor**：代码重构
- **test**：测试相关
- **chore**：构建、依赖等其他修改

### 2.3 范围
- 可选，用于指定修改的范围，如模块、文件等
- 例如：`feat(auth): 添加登录功能`

### 2.4 描述
- 简短描述，不超过 50 个字符
- 使用祈使句，现在时态
- 首字母小写，结尾不加句号

### 2.5 正文
- 可选，详细描述修改内容
- 每行不超过 72 个字符
- 解释修改的原因和实现方式

### 2.6 脚注
- 可选，用于引用 issue 或 PR
- 例如：`Fixes #123` 或 `Closes #456`

## 3. 代码提交流程

### 3.1 开发流程
1. 从 develop 分支创建 feature 分支
2. 在 feature 分支上进行开发
3. 开发完成后，提交 Pull Request 到 develop 分支
4. 代码审查通过后，合并到 develop 分支
5. 删除 feature 分支

### 3.2 发布流程
1. 从 develop 分支创建 release 分支
2. 在 release 分支上进行测试和修复
3. 准备发布版本，更新版本号和 CHANGELOG
4. 提交 Pull Request 到 main 分支
5. 代码审查通过后，合并到 main 分支
6. 在 main 分支上创建标签（tag）
7. 删除 release 分支

### 3.3 热修复流程
1. 从 main 分支创建 hotfix 分支
2. 在 hotfix 分支上进行修复
3. 提交 Pull Request 到 main 和 develop 分支
4. 代码审查通过后，合并到 main 和 develop 分支
5. 在 main 分支上创建标签（tag）
6. 删除 hotfix 分支

## 4. 代码审查规范

### 4.1 Pull Request 规范
- 每个 Pull Request 应该只包含一个功能或修复
- 标题清晰描述修改内容
- 正文详细说明修改的原因和实现方式
- 关联相关的 issue
- 确保所有测试通过

### 4.2 代码审查要点
- 代码质量和风格
- 功能正确性
- 安全性
- 性能
- 可读性和可维护性

## 5. 标签（Tag）规范

### 5.1 版本号格式
```
v<主版本>.<次版本>.<修订版本>
```

### 5.2 标签命名
- 例如：`v1.0.0`、`v1.0.1`
- 主版本：重大变更，不向后兼容
- 次版本：新功能，向后兼容
- 修订版本：bug 修复，向后兼容

## 6. 其他规范

### 6.1 .gitignore
- 项目根目录应该包含 .gitignore 文件
- 忽略不需要版本控制的文件和目录，如 node_modules、dist、target 等

### 6.2 提交频率
- 保持提交粒度适中，每个提交应该是一个完整的功能或修复
- 避免一次性提交大量修改

### 6.3 代码冲突
- 定期从上游分支拉取最新代码，避免冲突
- 解决冲突时要仔细检查，确保代码逻辑正确

## 7. GitHub 规范

### 7.1 仓库设置
- **分支保护**：对 main 和 develop 分支启用分支保护
  - 要求代码审查
  - 要求状态检查通过
  - 禁止直接推送
- **Issue 模板**：配置标准化的 Issue 模板
- **Pull Request 模板**：配置标准化的 PR 模板

### 7.2 Issue 管理
- 使用清晰的标题和详细的描述
- 为 Issue 添加适当的标签
- 关联相关的 PR
- 定期清理和关闭已解决的 Issue

### 7.3 Pull Request 管理
- PR 标题应清晰描述修改内容
- PR 正文应包含：
  - 修改的原因
  - 实现方式
  - 测试结果
  - 关联的 Issue
- 每个 PR 应只包含一个功能或修复
- 确保所有测试通过
- 代码审查通过后再合并

### 7.4 版本发布
- 使用 GitHub Releases 发布版本
- 发布说明应包含：
  - 版本号
  - 主要变更
  - 修复的问题
  - 向后兼容性说明

## 8. Git 工作流最佳实践

### 8.1 日常开发
- 每天开始工作前，从上游分支拉取最新代码
- 保持提交粒度适中
- 定期推送本地分支到远程仓库
- 使用 `git stash` 暂存未完成的工作

### 8.2 代码冲突解决
- 保持冷静，仔细分析冲突原因
- 查看冲突文件的上下文
- 与团队成员沟通，确保解决方案正确
- 解决冲突后，进行测试验证

### 8.3 历史管理
- 保持提交历史清晰、有序
- 避免使用 `git push --force` 改写远程分支历史
- 对于本地分支，可以使用 `git rebase` 整理历史

## 9. 仓库维护

### 9.1 定期清理
- 删除已合并的分支
- 清理本地和远程的过时分支
- 定期运行 `git gc` 优化仓库

### 9.2 安全管理
- 不提交敏感信息（如密码、API 密钥）
- 使用 `.gitignore` 忽略敏感文件
- 定期检查依赖项的安全漏洞

### 9.3 文档维护
- 保持 README.md 等文档的更新
- 记录重要的开发决策和架构变更

## 10. 示例

### 10.1 示例 Commit 消息
```
feat(auth): 添加登录功能

实现了用户登录功能，包括账号密码验证和 JWT  token 生成

Fixes #123
```

### 10.2 示例分支名称
- 功能分支：`feature/login`
- Bug 修复分支：`bugfix/error-handling`
- 发布分支：`release/1.0.0`
- 热修复分支：`hotfix/security-issue`

### 10.3 示例 Pull Request 标题
- `feat(auth): 添加登录功能`
- `fix(users): 修复用户信息更新失败问题`
- `docs(readme): 更新项目说明文档`
